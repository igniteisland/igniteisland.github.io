import{u as h,r,k as _,c as d,b as t,h as u,w as n,p as i,t as x,o as v}from"./index-gLaTdWCb.js";import{s as p}from"./supabase-B1cBYtZ_.js";const c={style:{"max-width":"700px",margin:"40px auto",padding:"16px"}},k={key:0},U={key:1,style:{opacity:".85"}},S={key:2,style:{display:"grid",gap:"12px","margin-top":"12px"}},V=["disabled"],B={style:{opacity:".85"}},E=h({__name:"ProfilePage",setup(D){const f=r(!0),m=r(!1),s=r(""),a=r(null);async function g(){s.value="",f.value=!0;try{const{data:o,error:e}=await p.auth.getUser();if(e)throw e;const l=o.user;if(!l){a.value=null,s.value="Not logged in.";return}const{data:b,error:y}=await p.from("profiles").select("user_id, handle, display_name, twitch, avatar_url, bio").eq("user_id",l.id).single();if(y)throw y;a.value=b}catch(o){s.value=o.message??String(o)}finally{f.value=!1}}async function w(){if(a.value){s.value="",m.value=!0;try{const{data:o}=await p.auth.getUser(),e=o.user;if(!e)throw new Error("Not logged in");const{error:l}=await p.from("profiles").update({handle:a.value.handle,display_name:a.value.display_name,twitch:a.value.twitch,avatar_url:a.value.avatar_url,bio:a.value.bio,updated_at:new Date().toISOString()}).eq("user_id",e.id);if(l)throw l;s.value="Saved ✅"}catch(o){s.value=o.message??String(o)}finally{m.value=!1}}}return _(g),(o,e)=>(v(),d("div",c,[e[10]||(e[10]=t("h1",null,"My Profile",-1)),f.value?(v(),d("div",k,"Loading…")):a.value?(v(),d("div",S,[t("label",null,[e[5]||(e[5]=u(" Handle (unique) ",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.handle=l),placeholder:"helios"},null,512),[[i,a.value.handle]])]),t("label",null,[e[6]||(e[6]=u(" Display name ",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.display_name=l),placeholder:"Helios"},null,512),[[i,a.value.display_name]])]),t("label",null,[e[7]||(e[7]=u(" Twitch ",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.twitch=l),placeholder:"kcbrazos"},null,512),[[i,a.value.twitch]])]),t("label",null,[e[8]||(e[8]=u(" Avatar URL ",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.avatar_url=l),placeholder:"https://..."},null,512),[[i,a.value.avatar_url]])]),t("label",null,[e[9]||(e[9]=u(" Bio ",-1)),n(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.bio=l),rows:"4",placeholder:"About me..."},null,512),[[i,a.value.bio]])]),t("button",{disabled:m.value,onClick:w},"Save",8,V),t("div",B,x(s.value),1)])):(v(),d("div",U," You need to sign in first. "))]))}});export{E as default};
