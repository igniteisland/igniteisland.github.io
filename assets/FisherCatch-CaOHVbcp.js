import{n as L}from"./TheIslandNavbar-DFYHLj8z.js";import{g as C,a as w}from"./TheIslandStoreEffects-wiUymp0W.js";import{_ as J,c as m,f as V,b as s,g as q,d as R,t as u,F as G,r,j as K,l as U,k as Y,o as g}from"./index-C5dtlzIh.js";const Q={name:"FisherCatch",components:{navbar:L},setup(){const F="https://script.google.com/macros/s/AKfycbxZG3LeBkiTAL7UiHqEI1Bbvj0_L2g12Uor9i283v5CYyR-nnX3FQqwVIC61WLMYpsd/exec",l="/data/season-2/weather.json",I="/data/season-2/role-widgets/fisherEffects.json",a={"Luminous Seashell":15,"Gleaming Sardine Scale":15,"Moby Dickâ€™s Harpoon":10,"The Black Pearl":15,"Cursed Cuttlefish Ink":15},N=["Rainy"],T=["Heat Wave","Clear"],d=r("Clear"),c=r(!1),b=r(!1),p=r(""),y=r(""),h=r(null),v=r(!1),x=r(null),k=r(""),_=r(!1),f=r("");function O(e){return new Promise(t=>setTimeout(t,e))}async function j(){const e=["ğŸŒŠ Scanning tidesâ€¦","ğŸª Baiting the hookâ€¦","ğŸŒ¬ï¸ Checking windâ€¦","ğŸ§® Calculating oddsâ€¦","ğŸ² Casting lineâ€¦"];for(let t=0;t<e.length;t++)k.value=e[t],await O(t<e.length-1?450:700)}function E(e){const t=Object.values(e).reduce((i,S)=>i+S,0),o=Math.random()*t;let n=0;for(const[i,S]of Object.entries(e))if(n+=S,o<=n)return i;return Object.keys(e)[0]||"Nothing"}function M(){if(b.value)return{totalSuccess:100,table:{...a},guaranteed:!0};let e={...a};if(N.includes(d.value)&&(e["Moby Dickâ€™s Harpoon"]=(e["Moby Dickâ€™s Harpoon"]||0)+10),T.includes(d.value))for(const o in e)e[o]=Math.max(0,e[o]-5);let t=Object.values(e).reduce((o,n)=>o+n,0);if(c.value)if(t>0){const n=80/t;for(const i in e)e[i]=Math.max(0,Math.round(e[i]*n));t=Object.values(e).reduce((i,S)=>i+S,0)}else t=0;return t=Math.max(0,Math.min(100,t)),{totalSuccess:t,table:e,guaranteed:!1}}const W=K(()=>{const{totalSuccess:e,guaranteed:t}=M();return t?"100% (Guaranteed)":`${e}%`});function B(){const e=M();if(e.guaranteed){const n=E(e.table);return{success:!0,roll:null,totalSuccess:100,caughtItem:n,message:`ğŸ£ Jeremy Wadeâ€™s net guarantees: ${n}`,guaranteed:!0,weights:e.table}}const t=Math.floor(Math.random()*100)+1;if(t>e.totalSuccess)return{success:!1,roll:t,totalSuccess:e.totalSuccess,caughtItem:null,message:"ğŸŸ Nothing was caught.",guaranteed:!1,weights:e.table};const o=E(e.table);return{success:!0,roll:t,totalSuccess:e.totalSuccess,caughtItem:o,message:`ğŸ£ Caught: ${o}`,guaranteed:!1,weights:e.table}}async function D(){try{const e=await fetch(l,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load weather.json");const o=(await e.json())?.[C.value]||{},n=`Day ${w.value}`,i=o?.[n];d.value=i?.weather||"Clear"}catch(e){console.error(e),d.value="Clear"}try{const e=await fetch(I,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load fisherEffects.json");const t=await e.json(),o=String(w.value),n=t?.[o]||{};c.value=!!n.teacherBuff,b.value=!!n.jeremyNet,p.value=n.storedItem||""}catch(e){console.error(e),c.value=!1,b.value=!1,p.value=""}}async function H(e){if(!h.value||h.value.mode!=="real"||h.value.submitted)return;_.value=!0,f.value="";const t={timestamp:new Date().toISOString(),season:C.value,day:w.value,role:"Fisher",weather:d.value,teacherBuff:c.value,jeremyNet:b.value,storedItem:p.value,success:e.success,roll:e.roll,totalSuccess:e.totalSuccess,caughtItem:e.caughtItem,guaranteed:e.guaranteed,message:e.message,mode:"real"};try{await fetch(F,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),h.value.submitted=!0,f.value="âœ… Submitted!"}catch(o){console.error("Submit failed:",o),f.value="âŒ Failed to submit"}finally{_.value=!1}}async function P(){if(v.value||_.value)return;f.value="",y.value="",h.value=null,x.value="fake",v.value=!0,await j();const e=B();y.value=`ğŸ§ª Practice Roll: ${e.message}`,h.value={...e,mode:"fake",submitted:!1},v.value=!1,k.value=""}async function A(){if(v.value||_.value)return;f.value="",y.value="",h.value=null,x.value="real",v.value=!0,await j();const e=B();y.value=e.message,h.value={...e,mode:"real",submitted:!1},v.value=!1,k.value="",await H(e)}return U([w,C],()=>D()),Y(async()=>{document.body.style.background="linear-gradient(90deg,rgba(217, 137, 9, 1) 0%, rgba(73, 0, 133, 1) 100%)",await D()}),{globalDay:w,globalSeason:C,fisherWeather:d,fisherTeacherBuff:c,jeremyNet:b,totalCatchChance:W,storedItem:p,fisherResult:y,rolling:v,suspenseText:k,submitting:_,submitStatus:f,runFakeRoll:P,runRealRoll:A}}},X={class:"page-wrapper grid-layout"},Z={class:"survive-box"},z={class:"context"},$={class:"line"},ee={class:"value"},te={class:"line"},se={class:"value"},ae={key:0,class:"line"},le={class:"value"},oe={class:"line"},ne={class:"value"},re={class:"line"},ie={class:"value"},ce={class:"line"},ue={class:"value"},de={class:"btn-row"},he=["disabled"],ve=["disabled"],fe={key:0,class:"suspense"},me={class:"suspense-text"},ge={key:1,class:"result pop"},be={key:2,class:"tiny status"},ye={key:3,class:"tiny status"};function _e(F,l,I,a,N,T){const d=q("navbar");return g(),m(G,null,[V(d),s("div",X,[s("div",Z,[l[9]||(l[9]=s("h2",null,"ğŸ£ Fisher Catch",-1)),s("div",z,[s("div",$,[l[2]||(l[2]=s("span",{class:"label"},"Day:",-1)),s("span",ee,u(a.globalDay),1)]),s("div",te,[l[3]||(l[3]=s("span",{class:"label"},"Weather:",-1)),s("span",se,u(a.fisherWeather),1)]),a.storedItem?(g(),m("div",ae,[l[4]||(l[4]=s("span",{class:"label"},"Stored Item:",-1)),s("span",le,u(a.storedItem),1)])):R("",!0),s("div",oe,[l[5]||(l[5]=s("span",{class:"label"},"Teacher Buff:",-1)),s("span",ne,u(a.fisherTeacherBuff?"ON":"OFF"),1)]),s("div",re,[l[6]||(l[6]=s("span",{class:"label"},"Jeremy Wadeâ€™s Net:",-1)),s("span",ie,u(a.jeremyNet?"ON":"OFF"),1)]),s("div",ce,[l[7]||(l[7]=s("span",{class:"label"},"Chance to Catch Something:",-1)),s("span",ue,u(a.totalCatchChance),1)])]),s("div",de,[s("button",{class:"btn ghost",onClick:l[0]||(l[0]=(...c)=>a.runFakeRoll&&a.runFakeRoll(...c)),disabled:a.rolling||a.submitting}," ğŸ§ª Fake Roll ",8,he),s("button",{class:"btn",onClick:l[1]||(l[1]=(...c)=>a.runRealRoll&&a.runRealRoll(...c)),disabled:a.rolling||a.submitting}," ğŸ² Real Roll ",8,ve)]),a.rolling?(g(),m("div",fe,[l[8]||(l[8]=s("div",{class:"spinner"},null,-1)),s("div",me,u(a.suspenseText),1)])):R("",!0),a.fisherResult&&!a.rolling?(g(),m("div",ge,u(a.fisherResult),1)):R("",!0),a.submitting?(g(),m("div",be,"ğŸ“¡ Submittingâ€¦")):a.submitStatus?(g(),m("div",ye,u(a.submitStatus),1)):R("",!0),l[10]||(l[10]=s("div",{class:"tiny hint bottom"}," Fake rolls never submit. Real rolls always submit. ",-1))])])],64)}const ke=J(Q,[["render",_e],["__scopeId","data-v-de0be95d"]]);export{ke as default};
