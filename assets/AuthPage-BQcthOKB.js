import{u as k,r as i,k as C,G as l,c as g,b as s,h as E,t as y,w as x,p as _,H as A,A as q,o as m}from"./index-BOtnhHoh.js";const P={style:{"max-width":"520px",margin:"40px auto",padding:"16px"}},V={key:0,style:{margin:"12px 0",padding:"12px",border:"1px solid #333","border-radius":"12px"}},z=["disabled"],B={key:1,style:{display:"grid",gap:"10px","margin-top":"12px"}},I={style:{display:"flex",gap:"10px"}},T=["disabled"],D=["disabled"],L={style:{"margin-top":"12px",opacity:".85"}},O=k({__name:"AuthPage",setup(M){const u=i(""),d=i(""),a=i(""),n=i(!1),c=i(null),h=q(),w=A();function p(e){return e.trim().toLowerCase()}function f(e){return`${p(e)}@players.local`}async function o(){const{data:e}=await l.auth.getUser();c.value=e.user?e.user.email?.split("@")[0]??null:null}C(async()=>{await o(),l.auth.onAuthStateChange(o)});async function b(){n.value=!0,a.value="";try{const e=p(u.value);if(!e)throw new Error("Username required");if(!/^[a-z0-9_]+$/.test(e))throw new Error("Username: a-z, 0-9, underscore only");if(e.length<3||e.length>20)throw new Error("Username must be 3–20 chars");const t=f(e),{error:r}=await l.auth.signUp({email:t,password:d.value});if(r)throw r;a.value="Account created ✅",await o();const v=w.query.redirect||"/Profiles";h.push(v)}catch(e){a.value=e.message??String(e)}finally{n.value=!1}}async function U(){n.value=!0,a.value="";try{const e=p(u.value);if(!e)throw new Error("Username required");const t=f(e),{error:r}=await l.auth.signInWithPassword({email:t,password:d.value});if(r)throw r;a.value="Signed in ✅",await o();const v=w.query.redirect||"/Profiles";h.push(v)}catch(e){a.value=e.message??String(e)}finally{n.value=!1}}async function S(){n.value=!0,a.value="";try{const{error:e}=await l.auth.signOut();if(e)throw e;a.value="Signed out.",await o()}catch(e){a.value=e.message??String(e)}finally{n.value=!1}}return(e,t)=>(m(),g("div",P,[t[3]||(t[3]=s("h1",null,"Login",-1)),c.value?(m(),g("div",V,[s("div",null,[t[2]||(t[2]=E("Signed in as: ",-1)),s("b",null,y(c.value),1)]),s("button",{disabled:n.value,onClick:S,style:{"margin-top":"10px"}},"Sign out",8,z)])):(m(),g("div",B,[x(s("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>u.value=r),placeholder:"username (a-z,0-9,_)",autocomplete:"username"},null,512),[[_,u.value]]),x(s("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>d.value=r),type:"password",placeholder:"password",autocomplete:"current-password"},null,512),[[_,d.value]]),s("div",I,[s("button",{disabled:n.value,onClick:U},"Sign in",8,T),s("button",{disabled:n.value,onClick:b},"Create account",8,D)])])),s("p",L,y(a.value),1)]))}});export{O as default};
