import{n as j}from"./TheIslandNavbar-DviYGLWJ.js";import{g as C,a as _}from"./TheIslandStoreEffects-Dia4KqbF.js";import{_ as V,c as h,f as q,b as a,g as J,d as w,t as r,F as K,r as o,j as H,l as U,k as W,o as b}from"./index-BoAzepiu.js";const z={name:"ScavengerCatch",components:{navbar:j},setup(){const T="https://script.google.com/macros/s/AKfycbxpZ5bC5o2v18nwDJLln8Kt2ha4DWPQvrJk7HUN4-oC1Uley1lVn7Sw1doaRqFPAM77qw/exec",n="/data/season-2/role-widgets/scavengerEffects.json",F={"Alternate Timeline":25,"The Equalizer":25,"The Summoning Key":25,"Celium Piece":25},t=Object.values(F).reduce((e,s)=>e+s,0),d=o(!1),v=o(!1),m=o(""),c=o(""),u=o(null),f=o(!1),x=o(null),y=o(""),S=o(!1),g=o("");function I(e){return new Promise(s=>setTimeout(s,e))}async function M(){const e=["ðŸ§­ Checking mapâ€¦","ðŸª™ Sifting rubbleâ€¦","ðŸ”¦ Scanning shadowsâ€¦","ðŸ§® Calculating oddsâ€¦","ðŸŽ² Searchingâ€¦"];for(let s=0;s<e.length;s++)y.value=e[s],await I(s<e.length-1?450:700)}function N(e){const s=Object.values(e).reduce((R,k)=>R+k,0),l=Math.random()*s;let i=0;for(const[R,k]of Object.entries(e))if(i+=k,l<=i)return R;return Object.keys(e)[0]||"Nothing"}const O=H(()=>{let e=10;return d.value&&(e+=10),v.value&&(e+=5),e=Math.max(0,Math.min(100,e)),`${e}%`});function E(){let e=10;d.value&&(e+=10),v.value&&(e+=5),e=Math.max(0,Math.min(100,e));const s=e/t,l={...F};for(const i in l)l[i]=Math.max(0,Math.round(l[i]*s));return{totalSuccess:e,table:l}}function p(){const e=E(),s=Math.floor(Math.random()*100)+1;if(s>e.totalSuccess||s<e.totalSuccess)return{success:!1,roll:s,totalSuccess:e.totalSuccess,foundItem:null,message:"ðŸ—‘ï¸ Nothing was found.",weights:e.table};const l=N(e.table);return{success:!0,roll:s,totalSuccess:e.totalSuccess,foundItem:l,message:`ðŸ” Found: ${l}`,weights:e.table}}async function D(){try{const e=await fetch(n,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load scavengerEffects.json");const s=await e.json(),l=String(_.value),i=s?.[l]||{};d.value=!!i.teacherBuff,v.value=!!i.satchel,m.value=i.storedFind||""}catch(e){console.error(e),d.value=!1,v.value=!1,m.value=""}}async function A(e){if(!u.value||u.value.mode!=="real"||u.value.submitted)return;S.value=!0,g.value="";const s={timestamp:new Date().toISOString(),season:C.value,day:_.value,role:"Scavenger",mode:"real",teacherBuff:d.value,satchel:v.value,storedFind:m.value,success:e.success,roll:e.roll,totalSuccess:e.totalSuccess,foundItem:e.foundItem,message:e.message};try{await fetch(T,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),u.value.submitted=!0,g.value="âœ… Submitted!"}catch(l){console.error("Submit failed:",l),g.value="âŒ Failed to submit"}finally{S.value=!1}}async function B(){if(f.value||S.value)return;g.value="",c.value="",u.value=null,x.value="fake",f.value=!0,await M();const e=p();c.value=`ðŸ§ª Practice Roll: ${e.message}`,u.value={...e,mode:"fake",submitted:!1},f.value=!1,y.value=""}async function P(){if(f.value||S.value)return;g.value="",c.value="",u.value=null,x.value="real",f.value=!0,await M();const e=p();c.value=e.message,u.value={...e,mode:"real",submitted:!1},f.value=!1,y.value="",await A(e)}return U([_,C],()=>D()),W(async()=>{document.body.style.background="linear-gradient(90deg,rgba(217, 137, 9, 1) 0%, rgba(73, 0, 133, 1) 100%)",await D()}),{globalDay:_,globalSeason:C,scavengerTeacherBuff:d,scavengerSatchel:v,storedFind:m,totalFindChance:O,scavengerResult:c,rolling:f,suspenseText:y,submitting:S,submitStatus:g,runFakeRoll:B,runRealRoll:P}}},G={class:"page-wrapper grid-layout"},L={class:"survive-box"},Q={class:"context"},Z={class:"line"},X={class:"value"},Y={class:"line"},$={class:"value"},ee={class:"line"},se={class:"value"},te={key:0,class:"line"},ae={class:"value"},ne={class:"line"},le={class:"value"},oe={class:"btn-row"},ce=["disabled"],ie=["disabled"],ue={key:0,class:"suspense"},re={class:"suspense-text"},de={key:1,class:"result pop"},ve={key:2,class:"tiny status"},fe={key:3,class:"tiny status"};function me(T,n,F,t,d,v){const m=J("navbar");return b(),h(K,null,[q(m),a("div",G,[a("div",L,[n[8]||(n[8]=a("h2",null,"ðŸ§­ Scavenger Finder",-1)),a("div",Q,[a("div",Z,[n[2]||(n[2]=a("span",{class:"label"},"Day:",-1)),a("span",X,r(t.globalDay),1)]),a("div",Y,[n[3]||(n[3]=a("span",{class:"label"},"Teacher Buff:",-1)),a("span",$,r(t.scavengerTeacherBuff?"ON":"OFF"),1)]),a("div",ee,[n[4]||(n[4]=a("span",{class:"label"},"Indiana Jonesâ€™ Satchel:",-1)),a("span",se,r(t.scavengerSatchel?"ON":"OFF"),1)]),t.storedFind?(b(),h("div",te,[n[5]||(n[5]=a("span",{class:"label"},"Found Artifacts:",-1)),a("span",ae,r(t.storedFind),1)])):w("",!0),a("div",ne,[n[6]||(n[6]=a("span",{class:"label"},"Chance to Find Something:",-1)),a("span",le,r(t.totalFindChance),1)])]),a("div",oe,[a("button",{class:"btn ghost",onClick:n[0]||(n[0]=(...c)=>t.runFakeRoll&&t.runFakeRoll(...c)),disabled:t.rolling||t.submitting}," ðŸ§ª Fake Roll ",8,ce),a("button",{class:"btn",onClick:n[1]||(n[1]=(...c)=>t.runRealRoll&&t.runRealRoll(...c)),disabled:t.rolling||t.submitting}," ðŸŽ² Real Roll ",8,ie)]),t.rolling?(b(),h("div",ue,[n[7]||(n[7]=a("div",{class:"spinner"},null,-1)),a("div",re,r(t.suspenseText),1)])):w("",!0),t.scavengerResult&&!t.rolling?(b(),h("div",de,r(t.scavengerResult),1)):w("",!0),t.submitting?(b(),h("div",ve,"ðŸ“¡ Submittingâ€¦")):t.submitStatus?(b(),h("div",fe,r(t.submitStatus),1)):w("",!0),n[9]||(n[9]=a("div",{class:"tiny hint bottom"}," Fake rolls never submit. Real rolls always submit. ",-1))])])],64)}const Se=V(z,[["render",me],["__scopeId","data-v-9e0dc9c3"]]);export{Se as default};
