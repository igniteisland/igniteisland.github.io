import{_ as z,c as v,f as G,b as l,g as Q,w as U,d as C,t as u,v as Y,F as K,e as q,r as o,j as X,l as Z,k as $,o as f}from"./index-40NZ2yF3.js";import{n as ee}from"./TheIslandNavbar-Cpz9sbSt.js";import{g as S,a as _}from"./TheIslandStoreEffects-DuiJjTC-.js";const ae={name:"FarmerCropWidget",components:{navbar:ee},setup(){const D="https://script.google.com/macros/s/AKfycbwn2JRk4Bz37cQmh6KKOK8UwwstyxX-niGSt4TQ-91ucIm_wh4T9Po5m4t_5iRlK5Y/exec",s="/data/season-2/weather.json",N="/data/season-2/role-widgets/farmerEffects.json",a={"Sneaky Spinach":50,"Lively Lemons":70,"Tasty Tangerine":70,"Trippy Tulips":70},k=["Hot"],F=["Freezing","Heat Wave"],c=o("Clear"),n=o(),d=o(),T=o(""),m=o(""),g=o(""),i=o(null),b=o(!1),x=o(null),w=o(""),E=o(!1),p=o(""),y=o(!1),R=o(!1);function O(e,t,r){return Math.max(t,Math.min(r,e))}async function B(){try{const e=await fetch(s,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load weather.json");const r=(await e.json())?.[S.value]||{},h=`Day ${_.value}`,M=r?.[h];c.value=M?.weather||"Clear"}catch(e){console.error(e),c.value="Clear"}try{const e=await fetch(N,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load farmerEffects.json");const t=await e.json(),r=String(_.value),h=t?.[r]||{};n.value=!!h.teacherBuff,d.value=!!h.specialClothes,T.value=h.storedCrop||""}catch(e){console.error(e),n.value=!1,d.value=!1,T.value=""}}const P=X(()=>{if(!m.value)return"â€”";let e=a[m.value];return F.includes(c.value)&&(e-=20),k.includes(c.value)&&(e+=10),n.value&&(e+=10),d.value&&(e=100),e=Math.max(0,Math.min(100,e)),`${e}%`});function j(e){let t=a[e];return F.includes(c.value)&&(t-=20),k.includes(c.value)&&(t+=10),n.value&&(t+=10),d.value&&(t=100),O(t,0,100)}function H(e){const t=j(e),r=Math.floor(Math.random()*100)+1,h=r<=t,M=h?`ğŸŒ± Successful Harvest! (${r} â‰¤ ${t}%)`:`ğŸ’€ YIKES! Crop Failed to Grow (${r} > ${t}%)`;return{success:h,roll:r,chance:t,message:M}}function A(e){return new Promise(t=>setTimeout(t,e))}async function W(){const e=["ğŸŒ¾ Checking soilâ€¦","ğŸ’§ Measuring moistureâ€¦","ğŸŒ¬ï¸ Reading the windâ€¦","ğŸ§ª Calculating chanceâ€¦","ğŸ² Rollingâ€¦"];for(let t=0;t<e.length;t++)w.value=e[t],await A(t<e.length-1?450:700)}async function I(e){if(!i.value||i.value.mode!=="real"||i.value.submitted)return;E.value=!0,p.value="";const t={timestamp:new Date().toISOString(),season:S.value,day:_.value,crop:m.value,weather:c.value,teacherBuff:n.value,specialClothes:d.value,success:e.success,roll:e.roll,chance:e.chance,message:e.message,mode:"real"};try{await fetch(D,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i.value.submitted=!0,p.value="âœ… Submitted!"}catch(r){console.error("Submit failed:",r),p.value="âŒ Failed to submit"}finally{E.value=!1}}async function V(){if(!m.value||b.value)return;p.value="",g.value="",i.value=null,y.value=!1,R.value=!1,x.value="fake",b.value=!0,await W();const e=H(m.value);g.value=`ğŸ§ª Practice Roll: ${e.message}`,i.value={...e,mode:"fake",submitted:!1},b.value=!1,w.value=""}async function J(){if(!m.value||b.value)return;p.value="",g.value="",i.value=null,y.value=!1,R.value=!1,x.value="real",b.value=!0,await W();const e=H(m.value);g.value=e.message,i.value={...e,mode:"real",submitted:!1},b.value=!1,w.value="",await I(e),y.value=!0}function L(){!i.value||i.value.mode!=="real"||(R.value=!0,y.value=!1)}return Z([_,S],()=>{B()}),$(async()=>{document.body.style.background="linear-gradient(90deg,rgba(217, 137, 9, 1) 0%, rgba(73, 0, 133, 1) 100%)",await B()}),{crops:a,selectedCrop:m,farmerWeather:c,teacherBuff:n,specialClothes:d,showChance:P,storedCrop:T,rolling:b,suspenseText:w,harvestResult:g,lastRoll:i,rollMode:x,runFakeRoll:V,runRealRoll:J,canConfirm:y,confirmed:R,confirmRoll:L,submitting:E,submitStatus:p,globalDay:_,globalSeason:S}}},se={class:"page-wrapper grid-layout"},le={class:"survive-box"},te={class:"context"},oe={class:"line"},ne={class:"value"},re={class:"line"},ie={class:"value"},ce={key:0,class:"line"},ue={class:"value"},de={class:"line"},ve={class:"value"},fe={class:"line"},me={class:"value"},he={key:1,class:"line"},be={class:"value"},pe=["disabled"],ge={class:"btn-row"},ye=["disabled"],Ce=["disabled"],_e={key:0,class:"suspense"},we={class:"suspense-text"},Re={key:1,class:"result pop"},Se={key:2,class:"tiny status"},ke={key:3,class:"tiny status"};function Fe(D,s,N,a,k,F){const c=Q("navbar");return f(),v(K,null,[G(c),l("div",se,[l("div",le,[s[11]||(s[11]=l("h2",null,"ğŸŒ¾ Farmer Harvest",-1)),l("div",te,[l("div",oe,[s[3]||(s[3]=l("span",{class:"label"},"Day:",-1)),l("span",ne,u(a.globalDay),1)]),l("div",re,[s[4]||(s[4]=l("span",{class:"label"},"Weather:",-1)),l("span",ie,u(a.farmerWeather),1)]),a.storedCrop?(f(),v("div",ce,[s[5]||(s[5]=l("span",{class:"label"},"Stored Crop:",-1)),l("span",ue,u(a.storedCrop),1)])):C("",!0),l("div",de,[s[6]||(s[6]=l("span",{class:"label"},"Teacher Buff:",-1)),l("span",ve,u(a.teacherBuff?"ON":"OFF"),1)]),l("div",fe,[s[7]||(s[7]=l("span",{class:"label"},"Special Clothes:",-1)),l("span",me,u(a.specialClothes?"ON":"OFF"),1)]),a.selectedCrop?(f(),v("div",he,[s[8]||(s[8]=l("span",{class:"label"},"What are your Chances?:",-1)),l("span",be,u(a.showChance),1)])):C("",!0)]),s[12]||(s[12]=l("label",{class:"mt"},"Choose Crop:",-1)),U(l("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.selectedCrop=n),class:"dropdown",disabled:a.rolling||a.submitting},[s[9]||(s[9]=l("option",{disabled:"",value:""},"-- Choose a Crop --",-1)),(f(!0),v(K,null,q(a.crops,(n,d)=>(f(),v("option",{key:d},u(d),1))),128))],8,pe),[[Y,a.selectedCrop]]),l("div",ge,[l("button",{class:"btn ghost",onClick:s[1]||(s[1]=(...n)=>a.runFakeRoll&&a.runFakeRoll(...n)),disabled:!a.selectedCrop||a.rolling||a.submitting}," ğŸ§ª Fake Roll ",8,ye),l("button",{class:"btn",onClick:s[2]||(s[2]=(...n)=>a.runRealRoll&&a.runRealRoll(...n)),disabled:!a.selectedCrop||a.rolling||a.submitting}," ğŸ² Real Roll ",8,Ce)]),a.rolling?(f(),v("div",_e,[s[10]||(s[10]=l("div",{class:"spinner"},null,-1)),l("div",we,u(a.suspenseText),1)])):C("",!0),a.harvestResult&&!a.rolling?(f(),v("div",Re,u(a.harvestResult),1)):C("",!0),a.submitting?(f(),v("div",Se,"ğŸ“¡ Submittingâ€¦")):a.submitStatus?(f(),v("div",ke,u(a.submitStatus),1)):C("",!0),s[13]||(s[13]=l("div",{class:"tiny hint bottom"}," Fake rolls never submit. Real rolls always submit. ",-1))])])],64)}const Me=z(ae,[["render",Fe],["__scopeId","data-v-c33f4e87"]]);export{Me as default};
