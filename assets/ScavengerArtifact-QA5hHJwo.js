import{n as j}from"./TheIslandNavbar-B6QdshaL.js";import{g as R,a as _}from"./TheIslandStoreEffects-DFKuwAjY.js";import{_ as V,c as b,f as q,b as a,g as J,d as p,t as u,F as K,r as o,j as H,l as U,k as W,o as h}from"./index-DkiF0y_1.js";const z={name:"ScavengerCatch",components:{navbar:j},setup(){const C="https://script.google.com/macros/s/AKfycbxpZ5bC5o2v18nwDJLln8Kt2ha4DWPQvrJk7HUN4-oC1Uley1lVn7Sw1doaRqFPAM77qw/exec",t="/data/season-2/role-widgets/scavengerEffects.json",F={"Alternate Timeline":15,"The Equalizer":15,"The Summoning Key":15,"Celium Piece":10},s=Object.values(F).reduce((e,n)=>e+n,0),d=o(!1),v=o(!1),m=o(""),c=o(""),r=o(null),f=o(!1),T=o(null),y=o(""),S=o(!1),g=o("");function D(e){return new Promise(n=>setTimeout(n,e))}async function x(){const e=["ðŸ§­ Checking mapâ€¦","ðŸª™ Sifting rubbleâ€¦","ðŸ”¦ Scanning shadowsâ€¦","ðŸ§® Calculating oddsâ€¦","ðŸŽ² Searchingâ€¦"];for(let n=0;n<e.length;n++)y.value=e[n],await D(n<e.length-1?450:700)}function M(e){const n=Object.values(e).reduce((w,k)=>w+k,0),l=Math.random()*n;let i=0;for(const[w,k]of Object.entries(e))if(i+=k,l<=i)return w;return Object.keys(e)[0]||"Nothing"}const O=H(()=>{let e=d.value?30:20;return v.value&&(e+=5),`${e}%`});function A(){let e=d.value?30:20;v.value&&(e+=5);const n=e/s,l={...F};for(const i in l)l[i]=Math.max(0,Math.round(l[i]*n));return e=Math.max(0,Math.min(100,e)),{totalSuccess:e,table:l}}function N(){const e=A(),n=Math.floor(Math.random()*100)+1;if(n>e.totalSuccess)return{success:!1,roll:n,totalSuccess:e.totalSuccess,foundItem:null,message:"ðŸ—‘ï¸ Nothing was found.",weights:e.table};const l=M(e.table);return{success:!0,roll:n,totalSuccess:e.totalSuccess,foundItem:l,message:`ðŸ” Found: ${l}`,weights:e.table}}async function E(){try{const e=await fetch(t,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load scavengerEffects.json");const n=await e.json(),l=String(_.value),i=n?.[l]||{};d.value=!!i.teacherBuff,v.value=!!i.satchel,m.value=i.storedFind||""}catch(e){console.error(e),d.value=!1,v.value=!1,m.value=""}}async function B(e){if(!r.value||r.value.mode!=="real"||r.value.submitted)return;S.value=!0,g.value="";const n={timestamp:new Date().toISOString(),season:R.value,day:_.value,role:"Scavenger",mode:"real",teacherBuff:d.value,satchel:v.value,storedFind:m.value,success:e.success,roll:e.roll,totalSuccess:e.totalSuccess,foundItem:e.foundItem,message:e.message};try{await fetch(C,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r.value.submitted=!0,g.value="âœ… Submitted!"}catch(l){console.error("Submit failed:",l),g.value="âŒ Failed to submit"}finally{S.value=!1}}async function I(){if(f.value||S.value)return;g.value="",c.value="",r.value=null,T.value="fake",f.value=!0,await x();const e=N();c.value=`ðŸ§ª Practice Roll: ${e.message}`,r.value={...e,mode:"fake",submitted:!1},f.value=!1,y.value=""}async function P(){if(f.value||S.value)return;g.value="",c.value="",r.value=null,T.value="real",f.value=!0,await x();const e=N();c.value=e.message,r.value={...e,mode:"real",submitted:!1},f.value=!1,y.value="",await B(e)}return U([_,R],()=>E()),W(async()=>{document.body.style.background="linear-gradient(90deg,rgba(217, 137, 9, 1) 0%, rgba(73, 0, 133, 1) 100%)",await E()}),{globalDay:_,globalSeason:R,scavengerTeacherBuff:d,scavengerSatchel:v,storedFind:m,totalFindChance:O,scavengerResult:c,rolling:f,suspenseText:y,submitting:S,submitStatus:g,runFakeRoll:I,runRealRoll:P}}},G={class:"page-wrapper grid-layout"},L={class:"survive-box"},Q={class:"context"},Z={class:"line"},X={class:"value"},Y={class:"line"},$={class:"value"},ee={class:"line"},se={class:"value"},ae={key:0,class:"line"},te={class:"value"},ne={class:"line"},le={class:"value"},oe={class:"btn-row"},ce=["disabled"],ie=["disabled"],re={key:0,class:"suspense"},ue={class:"suspense-text"},de={key:1,class:"result pop"},ve={key:2,class:"tiny status"},fe={key:3,class:"tiny status"};function me(C,t,F,s,d,v){const m=J("navbar");return h(),b(K,null,[q(m),a("div",G,[a("div",L,[t[8]||(t[8]=a("h2",null,"ðŸ§­ Scavenger Finder",-1)),a("div",Q,[a("div",Z,[t[2]||(t[2]=a("span",{class:"label"},"Day:",-1)),a("span",X,u(s.globalDay),1)]),a("div",Y,[t[3]||(t[3]=a("span",{class:"label"},"Teacher Buff:",-1)),a("span",$,u(s.scavengerTeacherBuff?"ON":"OFF"),1)]),a("div",ee,[t[4]||(t[4]=a("span",{class:"label"},"Indiana Jonesâ€™ Satchel:",-1)),a("span",se,u(s.scavengerSatchel?"ON":"OFF"),1)]),s.storedFind?(h(),b("div",ae,[t[5]||(t[5]=a("span",{class:"label"},"Found Artifacts:",-1)),a("span",te,u(s.storedFind),1)])):p("",!0),a("div",ne,[t[6]||(t[6]=a("span",{class:"label"},"Chance to Find Something:",-1)),a("span",le,u(s.totalFindChance),1)])]),a("div",oe,[a("button",{class:"btn ghost",onClick:t[0]||(t[0]=(...c)=>s.runFakeRoll&&s.runFakeRoll(...c)),disabled:s.rolling||s.submitting}," ðŸ§ª Fake Roll ",8,ce),a("button",{class:"btn",onClick:t[1]||(t[1]=(...c)=>s.runRealRoll&&s.runRealRoll(...c)),disabled:s.rolling||s.submitting}," ðŸŽ² Real Roll ",8,ie)]),s.rolling?(h(),b("div",re,[t[7]||(t[7]=a("div",{class:"spinner"},null,-1)),a("div",ue,u(s.suspenseText),1)])):p("",!0),s.scavengerResult&&!s.rolling?(h(),b("div",de,u(s.scavengerResult),1)):p("",!0),s.submitting?(h(),b("div",ve,"ðŸ“¡ Submittingâ€¦")):s.submitStatus?(h(),b("div",fe,u(s.submitStatus),1)):p("",!0),t[9]||(t[9]=a("div",{class:"tiny hint bottom"}," Fake rolls never submit. Real rolls always submit. ",-1))])])],64)}const Se=V(z,[["render",me],["__scopeId","data-v-7e64d823"]]);export{Se as default};
