import{n as P}from"./TheIslandNavbar-BdQjouPR.js";import{g as p,a as w}from"./TheIslandStoreEffects-C0vHQPdD.js";import{_ as A,c as g,f as J,b as a,g as V,d as T,t as c,F as L,r,j as U,l as X,k as q,o as m}from"./index-CNg_ZBLh.js";const z={name:"HunterCatch",components:{navbar:P},setup(){const C="https://script.google.com/macros/s/AKfycbwMxd4DZGjhHbSVBH0tgggFKLRL2dDaXUKxTbWuedy-Ck2iumSYXK_-1BDRaWuw2lto/exec",o="/data/season-2/weather.json",F="/data/season-2/role-widgets/hunterEffects.json",s=["Clear"],x=["Freezing","Rainy"],H={"Ethereal Eagle":15,"Envious Fox":15,"Mystical Owl":15,"Sif, The Great Grey Wolf":10,"Jinxed Jackrabbit":15},d=r("Clear"),i=r(!1),b=r(!1),R=r(""),y=r(""),v=r(null),h=r(!1),E=r(null),k=r(""),_=r(!1),f=r("");function j(e){return new Promise(t=>setTimeout(t,e))}async function N(){const e=["ğŸŒ² Reading tracksâ€¦","ğŸŒ¬ï¸ Checking windâ€¦","ğŸ¦Œ Scanning the treelineâ€¦","ğŸ§® Calculating oddsâ€¦","ğŸ² Taking the shotâ€¦"];for(let t=0;t<e.length;t++)k.value=e[t],await j(t<e.length-1?450:700)}function D(e){const t=Object.values(e).reduce((u,S)=>u+S,0),l=Math.random()*t;let n=0;for(const[u,S]of Object.entries(e))if(n+=S,l<=n)return u;return Object.keys(e)[0]||"Nothing"}function M(){if(b.value)return{totalSuccess:100,table:{...H},guaranteed:!0};let e={...H};if(s.includes(d.value)&&(e["Sif, The Great Grey Wolf"]=(e["Sif, The Great Grey Wolf"]||0)+10),x.includes(d.value))for(const l in e)e[l]=Math.max(0,e[l]-5);let t=Object.values(e).reduce((l,n)=>l+n,0);if(i.value)if(t>0){const n=80/t;for(const u in e)e[u]=Math.max(0,Math.round(e[u]*n));t=Object.values(e).reduce((u,S)=>u+S,0)}else t=0;return t=Math.max(0,Math.min(100,t)),{totalSuccess:t,table:e,guaranteed:!1}}const B=U(()=>{const{totalSuccess:e,guaranteed:t}=M();return t?"100% (Guaranteed)":`${e}%`});function O(){const e=M();if(e.guaranteed){const n=D(e.table);return{success:!0,roll:null,totalSuccess:100,caughtItem:n,message:`ğŸ¹ Robin Hood's Hat guarantees: ${n}`,guaranteed:!0,weights:e.table}}const t=Math.floor(Math.random()*100)+1;if(t>e.totalSuccess)return{success:!1,roll:t,totalSuccess:e.totalSuccess,caughtItem:null,message:"ğŸ¾ Nothing was caught.",guaranteed:!1,weights:e.table};const l=D(e.table);return{success:!0,roll:t,totalSuccess:e.totalSuccess,caughtItem:l,message:`ğŸ¹ Caught: ${l}`,guaranteed:!1,weights:e.table}}async function W(){try{const e=await fetch(o,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load weather.json");const l=(await e.json())?.[p.value]||{},n=`Day ${w.value}`,u=l?.[n];d.value=u?.weather||"Clear"}catch(e){console.error(e),d.value="Clear"}try{const e=await fetch(F,{cache:"no-store"});if(!e.ok)throw new Error("Failed to load hunterEffects.json");const t=await e.json(),l=String(w.value),n=t?.[l]||{};i.value=!!n.teacherBuff,b.value=!!n.robinHood,R.value=n.storedTarget||""}catch(e){console.error(e),i.value=!1,b.value=!1,R.value=""}}async function G(e){if(!v.value||v.value.mode!=="real"||v.value.submitted)return;_.value=!0,f.value="";const t={timestamp:new Date().toISOString(),season:p.value,day:w.value,role:"Hunter",mode:"real",weather:d.value,teacherBuff:i.value,robinHood:b.value,storedTarget:R.value,success:e.success,roll:e.roll,totalSuccess:e.totalSuccess,caughtItem:e.caughtItem,guaranteed:e.guaranteed,message:e.message};try{await fetch(C,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),v.value.submitted=!0,f.value="âœ… Submitted!"}catch(l){console.error("Submit failed:",l),f.value="âŒ Failed to submit"}finally{_.value=!1}}async function I(){if(h.value||_.value)return;f.value="",y.value="",v.value=null,E.value="fake",h.value=!0,await N();const e=O();y.value=`ğŸ§ª Practice Roll: ${e.message}`,v.value={...e,mode:"fake",submitted:!1},h.value=!1,k.value=""}async function K(){if(h.value||_.value)return;f.value="",y.value="",v.value=null,E.value="real",h.value=!0,await N();const e=O();y.value=e.message,v.value={...e,mode:"real",submitted:!1},h.value=!1,k.value="",await G(e)}return X([w,p],()=>W()),q(async()=>{document.body.style.background="linear-gradient(90deg,rgba(217, 137, 9, 1) 0%, rgba(73, 0, 133, 1) 100%)",await W()}),{globalDay:w,globalSeason:p,hunterWeather:d,hunterTeacherBuff:i,robinHood:b,storedTarget:R,totalHuntChance:B,hunterResult:y,rolling:h,suspenseText:k,submitting:_,submitStatus:f,runFakeRoll:I,runRealRoll:K}}},Y={class:"page-wrapper grid-layout"},Z={class:"survive-box"},Q={class:"context"},$={class:"line"},ee={class:"value"},te={class:"line"},ae={class:"value"},se={class:"line"},oe={class:"value"},le={class:"line"},ne={class:"value"},re={key:0,class:"line"},ue={class:"value"},ie={class:"line"},ce={class:"value"},de={class:"btn-row"},ve=["disabled"],he=["disabled"],fe={key:0,class:"suspense"},ge={class:"suspense-text"},me={key:1,class:"result pop"},be={key:2,class:"tiny status"},ye={key:3,class:"tiny status"};function _e(C,o,F,s,x,H){const d=V("navbar");return m(),g(L,null,[J(d),a("div",Y,[a("div",Z,[o[9]||(o[9]=a("h2",null,"ğŸ¹ Hunter Catch",-1)),a("div",Q,[a("div",$,[o[2]||(o[2]=a("span",{class:"label"},"Day:",-1)),a("span",ee,c(s.globalDay),1)]),a("div",te,[o[3]||(o[3]=a("span",{class:"label"},"Weather:",-1)),a("span",ae,c(s.hunterWeather),1)]),a("div",se,[o[4]||(o[4]=a("span",{class:"label"},"Teacher Buff:",-1)),a("span",oe,c(s.hunterTeacherBuff?"ON":"OFF"),1)]),a("div",le,[o[5]||(o[5]=a("span",{class:"label"},"Robin Hoodâ€™s Hat:",-1)),a("span",ne,c(s.robinHood?"ON":"OFF"),1)]),s.storedTarget?(m(),g("div",re,[o[6]||(o[6]=a("span",{class:"label"},"Stored Target:",-1)),a("span",ue,c(s.storedTarget),1)])):T("",!0),a("div",ie,[o[7]||(o[7]=a("span",{class:"label"},"Chance to Catch Something:",-1)),a("span",ce,c(s.totalHuntChance),1)])]),a("div",de,[a("button",{class:"btn ghost",onClick:o[0]||(o[0]=(...i)=>s.runFakeRoll&&s.runFakeRoll(...i)),disabled:s.rolling||s.submitting}," ğŸ§ª Fake Roll ",8,ve),a("button",{class:"btn",onClick:o[1]||(o[1]=(...i)=>s.runRealRoll&&s.runRealRoll(...i)),disabled:s.rolling||s.submitting}," ğŸ² Real Roll ",8,he)]),s.rolling?(m(),g("div",fe,[o[8]||(o[8]=a("div",{class:"spinner"},null,-1)),a("div",ge,c(s.suspenseText),1)])):T("",!0),s.hunterResult&&!s.rolling?(m(),g("div",me,c(s.hunterResult),1)):T("",!0),s.submitting?(m(),g("div",be,"ğŸ“¡ Submittingâ€¦")):s.submitStatus?(m(),g("div",ye,c(s.submitStatus),1)):T("",!0),o[10]||(o[10]=a("div",{class:"tiny hint bottom"}," Fake rolls never submit. Real rolls always submit. ",-1))])])],64)}const ke=A(z,[["render",_e],["__scopeId","data-v-05dbe82d"]]);export{ke as default};
