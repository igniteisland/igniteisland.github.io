import{u as _,r as i,k as h,c as n,b as t,h as u,w as r,p as d,t as c,G as v,o as p}from"./index-BdHVKk1d.js";const x={style:{"max-width":"700px",margin:"40px auto",padding:"16px"}},U={key:0},k={key:1,style:{opacity:".85"}},S={key:2,style:{display:"grid",gap:"12px","margin-top":"12px"}},V=["value"],B=["disabled"],D={style:{opacity:".85"}},M=_({__name:"ProfilePage",setup(N){const m=i(!0),f=i(!1),o=i(""),a=i(null);async function g(){o.value="",m.value=!0;try{const{data:s,error:e}=await v.auth.getUser();if(e)throw e;const l=s.user;if(!l){a.value=null,o.value="Not logged in.";return}const{data:b,error:y}=await v.from("profiles").select("user_id, username, display_name, twitch, avatar_url, bio").eq("user_id",l.id).single();if(y)throw y;a.value=b}catch(s){o.value=s.message??String(s)}finally{m.value=!1}}async function w(){if(a.value){o.value="",f.value=!0;try{const{data:s}=await v.auth.getUser(),e=s.user;if(!e)throw new Error("Not logged in");const{error:l}=await v.from("profiles").update({display_name:a.value.display_name,twitch:a.value.twitch,avatar_url:a.value.avatar_url,bio:a.value.bio,updated_at:new Date().toISOString()}).eq("user_id",e.id);if(l)throw l;o.value="Saved ✅"}catch(s){o.value=s.message??String(s)}finally{f.value=!1}}}return h(g),(s,e)=>(p(),n("div",x,[e[9]||(e[9]=t("h1",null,"My Profile",-1)),m.value?(p(),n("div",U,"Loading…")):a.value?(p(),n("div",S,[t("label",null,[e[4]||(e[4]=u(" Username ",-1)),t("input",{value:a.value.username,disabled:""},null,8,V)]),t("label",null,[e[5]||(e[5]=u(" Display name ",-1)),r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.display_name=l),placeholder:"Your name"},null,512),[[d,a.value.display_name]])]),t("label",null,[e[6]||(e[6]=u(" Twitch ",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.twitch=l),placeholder:"twitch handle"},null,512),[[d,a.value.twitch]])]),t("label",null,[e[7]||(e[7]=u(" Avatar URL ",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.avatar_url=l),placeholder:"https://..."},null,512),[[d,a.value.avatar_url]])]),t("label",null,[e[8]||(e[8]=u(" Bio ",-1)),r(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.bio=l),rows:"4",placeholder:"About me..."},null,512),[[d,a.value.bio]])]),t("button",{disabled:f.value,onClick:w},"Save",8,B),t("div",D,c(o.value),1)])):(p(),n("div",k," You need to sign in first. "))]))}});export{M as default};
